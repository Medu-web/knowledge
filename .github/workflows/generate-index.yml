name: Generate Index
on: [push, workflow_dispatch] # 手動実行ボタンも追加
permissions:
  contents: write
jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - name: Generate Index HTML
        run: |
          echo "<!DOCTYPE html><html><head><meta charset='utf-8'><title>教材目次</title></head><body>" > index.html
          echo "<h1>教材資料インデックス</h1><ul>" >> index.html
          
          # 全フォルダを再帰的に探し、PDFをリスト化
          # ファイル名に特殊文字があっても壊れないように処理
          find . -name "*.pdf" -not -path '*/.*' | sort | while read -r line; do
            path=$(echo "$line" | sed 's|^\./||')
            echo "<li><a href=\"$path\">$path</a></li>" >> index.html
          done
          
          echo "</ul></body></html>" >> index.html
      - name: Commit index
        run: |
          git config --local user.email "action@github.com"
          git config --local user.name "GitHub Action"
          git add index.html
          git commit -m "目次を再生成しました" || exit 0
          git push
